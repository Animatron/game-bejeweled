<!DOCTYPE html>
<html>
	<head>
		<title>Bejeweled - Animatron HTML5 Player Demo</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<script src="../player/vendor/matrix.js" type="text/javascript"></script>
		<script src="../player/anm.player.js" type="text/javascript"></script>
        <script src="../player/anm.collisions.js" type="text/javascript"></script>
		<script src="../player/anm.builder.js" type="text/javascript"></script>
		<script src="../player/animatron_import.js" type="text/javascript"></script>

		<script type="text/javascript">
			var b = Builder._$, B = Builder, C = anm.C;
			
			// canvas1
            var scene1 = b();
			
			var width = 6; var height = 8;
			var mode = "grow";
			var numShapes = 5;
			var swapDuration = .5;
			var board = new Array(height);
			
			var swap1 = null;
			var swap2 = null;
			
			function swap(i, j) {
				console.log("hit: "+i+", "+j);
				if (swap1 == null)
					swap1 = [i, j];
				else {
					swap2 = [i, j];
					console.log("swapping: "+swap1+", "+swap2);
					mode = "swap";
				}
			}
			
			var gameLoop = function(t) {
			}
			
			function start() {
           		// 24x24
          		var octagon = b().path([ [-4, -12], [-12, -4], [-12, 4], [-4, 12], [4, 12], [12, 4], [12, -4], [4, -12], [-4, -12] ]).fill('#aaa');
				var diamond = b().path([ [0, -12], [-12, 0], [0, 12], [12, 0], [0, -12] ]).fill('#cc0');
				var triangle = b().path([ [-12, 12], [0, -12], [12, 12], [-12, 12] ]).fill('#c0a');
				var square = b().rect([0, 0], [24, 24]).fill('#c00');
				var hexagon = b().path([ [0, -12], [-12, -6], [-12, 6], [0, 12], [12, 6], [12, -6], [0, -12] ]).fill('#fa0');
				
				var shape = [octagon, diamond, triangle, square, hexagon];
    			
				// init board
				for (var i=0; i<height; i++) {
					board[i] = new Array(width);
					for (var j=0; j<width; j++)
						board[i][j] = Math.floor(Math.random()*numShapes);
				}
				
				var area = b().rect([width*16, height*16], [width*32, height*32]).fill('#fff')
							.modify(gameLoop);
				scene1.add(area);
				// draw from board
				for (var i=0; i<height; i++)
					for (var j=0; j<width; j++) {
						scene1.add(b(shape[board[i][j]])
							.move([16 + 32*j, 16 + 32*i])
							.xscale([0, .5], [0, 1])
							.on(C.X_MCLICK, function(x, y) {
									return function(evt) {
										if (this.$.contains(evt.pos))
											swap(x, y); 
									}
								}(i, j))
							);
					}
				
				setTimeout("mode = 'wait';", 500);
				
                createPlayer('canvas1', {'mode': C.M_DYNAMIC}).load(scene1).play();
    
            }
        </script>
      </head>

	<body onload="start();">
		<h1>Bejeweled - Animatron HTML5 Player Demo</h1>

		<!-- canvas1 -->
		<canvas id="canvas1"></canvas>

	</body>

</html>